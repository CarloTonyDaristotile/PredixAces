<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/px-dropdown/px-dropdown.html">
<link rel="import" href="../../bower_components/px-dropdown/px-dropdown-content.html">
<link rel="import" href="../asset-browser/asset-browser.html">
<link rel="import" href="../seed-table/seed-table.html">
<link rel="import" href="../kpi-bar/kpi-bar.html">
<link rel="import" href="../../bower_components/px-card/px-card.html">
<link rel="import" href="../../bower_components/px-spinner/px-spinner.html">

<dom-module id="rmd-view">
  <style>
  :host {
    --iron-icon-width: 16px;
    --iron-icon-height: 16px;
  }
  </style>
  <template>
      <h1>Test</h1>
      <px-card header-text="Card" icon="px-fea:analysis"><div class='actions'><px-icon icon='px-nav:new-window'></px-icon><px-icon icon='px-utl:help'></px-icon><px-icon icon='px-utl:app-settings'></px-icon></div><p>This is the main content area of a Predix card.</p></px-card>      
      <px-spinner size="100"></px-spinner>     
   
   
  </template>
  <script>
      
      // make a new variable A
      // store data JSON "response" object to this newly created variable A
      
      
    Polymer({
      is: 'rmd-view',
      properties: {
        rmdAssetModel: {
          type: Object,
          observer: '_assetModelChanged'
        },
        openedAsset: {
          type: Object,
          observer: '_openedAssetChanged'
        },
        rmdTableData: {
          type: Object
        },
        displayTags: {
          type: Array
        },
        showTimeseriesChart: {
          type: Boolean,
          value: false
        },
        wsUrl: {
          type: String
        },
        kpiBarWrapperState: {
          type: String
        }
      },

      _formatTagsForDisplay: function(assetTag) {
        var tags = []
        Object.keys(assetTag).forEach(function(key) {
          var tag = {
            key: assetTag[key].timeseriesDatasource.tag,
            val: assetTag[key].label,
            unit: 'psi'
          }
          if (tag.key.indexOf('Temperature')>-1) {
            tag.unit = 'F';
          } else if (tag.key.indexOf('Ratio')>-1) {
            tag.unit = '';
          } else if (tag.key.indexOf('Velocity')>-1) {
            tag.unit = 'm/s'
          }
          tags.push(tag);
        });
        return tags;
      },
      _openedAssetChanged: function(newVal) {
        console.log('asset opened:', newVal);
        this.$.datatableAjaxEl.url = "/api/datagrid" + newVal.uri;
        this.$.kpiBarAjaxEl.url = this.$.datatableAjaxEl.url + '/summary';
        this.$.datatableAjaxEl.generateRequest();
        if (newVal.assetTag) {
          this.displayTags = this._formatTagsForDisplay(newVal.assetTag);
        }
        this.showTimeseriesChart = newVal.uri.indexOf('asset') >= 0;
      },
      _assetModelChanged: function(newVal) {
        console.log('asset model changed:', newVal);
      },

      // We'll load the timeseries-chart asynchronously, since it's pretty heavy.
      _loadFragment: function(elementId, fragmentPath) {
        if (Polymer.isInstance(this.$[elementId])) {
          return;
        }
        Polymer.Base.importHref(fragmentPath, null, function() {
          console.log('failed to load:', fragmentPath);
        }, true);
      },

      ready: function(){
      }
    });
      
      ////////////////////////////////////////
      ////////////////////////////////////////
      
      
      var settings = {
  "async": true,
  "crossDomain": true,
  "url": "https://time-series-store-predix.run.aws-usw02-pr.ice.predix.io/v1/datapoints",
  "method": "POST",
  "headers": {
    "authorization": "bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImxlZ2FjeS10b2tlbi1rZXkiLCJ0eXAiOiJKV1QifQ.eyJqdGkiOiJkMTQzN2VmNzZkMmY0MmJjYjUzNTE4M2NjMDZhN2VjOSIsInN1YiI6ImFwcF9jbGllbnRfaWRfMTMiLCJzY29wZSI6WyJ0aW1lc2VyaWVzLnpvbmVzLmYzZTFlZjI3LTk1NDMtNGI1ZS1hMTVmLTE4NmVlZWVhMzZkMy5pbmdlc3QiLCJ0aW1lc2VyaWVzLnpvbmVzLmYzZTFlZjI3LTk1NDMtNGI1ZS1hMTVmLTE4NmVlZWVhMzZkMy5xdWVyeSIsInRpbWVzZXJpZXMuem9uZXMuZjNlMWVmMjctOTU0My00YjVlLWExNWYtMTg2ZWVlZWEzNmQzLnVzZXIiLCJ1YWEucmVzb3VyY2UiLCJvcGVuaWQiLCJ1YWEubm9uZSIsInByZWRpeC1hc3NldC56b25lcy41OGE2ZmEzYy0yM2QyLTQzNWMtOWIzNy03YjVlZWQ0NDVjNjgudXNlciJdLCJjbGllbnRfaWQiOiJhcHBfY2xpZW50X2lkXzEzIiwiY2lkIjoiYXBwX2NsaWVudF9pZF8xMyIsImF6cCI6ImFwcF9jbGllbnRfaWRfMTMiLCJncmFudF90eXBlIjoiY2xpZW50X2NyZWRlbnRpYWxzIiwicmV2X3NpZyI6IjEzZjdjMzgyIiwiaWF0IjoxNTAxMzUwMTMxLCJleHAiOjE1MDEzOTMzMzEsImlzcyI6Imh0dHBzOi8vNzdhMzg2N2ItY2NlMC00MjNkLWE4ZWMtNDQ4ZDIwNDI2OTg0LnByZWRpeC11YWEucnVuLmF3cy11c3cwMi1wci5pY2UucHJlZGl4LmlvL29hdXRoL3Rva2VuIiwiemlkIjoiNzdhMzg2N2ItY2NlMC00MjNkLWE4ZWMtNDQ4ZDIwNDI2OTg0IiwiYXVkIjpbInVhYSIsIm9wZW5pZCIsInByZWRpeC1hc3NldC56b25lcy41OGE2ZmEzYy0yM2QyLTQzNWMtOWIzNy03YjVlZWQ0NDVjNjgiLCJ0aW1lc2VyaWVzLnpvbmVzLmYzZTFlZjI3LTk1NDMtNGI1ZS1hMTVmLTE4NmVlZWVhMzZkMyIsImFwcF9jbGllbnRfaWRfMTMiXX0.T7JmscVYRdjEIcbt7tKZS7hLrCXiD-L5qOAma535b3-rMRfX6waiMrRLHUQNA57IcTQXjemwdqe__dCa2jyAG3Mw1KbE0uKdIKvMQhHUJGWLgnu0UuXEOYfUGhqqfsBzik2B_PqcYjZXGRVrpfpDxgcUQNzso9Ij2pwdC4CYMtw1HYuN0YtB2AX7AdYVtdGc6KbES9QcxhqYO1rHXFLYwuezFhv2wB4wVkGvDkhZvCPPzAvRFt1-ORqmMh8qC12cbZKn39KuxmUcSq2Ugk9X2ueD3LGtVsdI9nlxLrBANxHbeHQw_T58xIXVi36NkpJNca70QjPmY_qs_y17Ag3s6Q",
    "predix-zone-id": "f3e1ef27-9543-4b5e-a15f-186eeeea36d3",
    "content-type": "application/json",
    "cache-control": "no-cache",
    "postman-token": "69983122-164e-af9d-c206-143811278c78"
  },
  "processData": false,
  "data": "{\n  \"tags\": [\n    {\n      \"name\": \"Humidity:STORAGE1\",\n      \"order\": \"desc\"\n    }\n  ],\n  \"start\": 1501276077\n\t\n}"
}

$.ajax(settings).done(function (response) {
  console.log(response);
    // ADD CODE to do something with "JSON object response"
});
      
      ////////////////////////////////////////////
      ////////////////////////////////////////////
      
  </script>
</dom-module>
